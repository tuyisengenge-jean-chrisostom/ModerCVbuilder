 <!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  
  <!-- ‚úÖ ESSENTIAL SEO TAGS -->
  <title>MODERN CV BUILDER</title>
  <meta name="description" content="Build your perfect CV for free! Choose from modern templates, fill your details, and download as PDF or CSV. No signup required. Create professional resumes in 5 minutes.">
  <meta name="keywords" content="cv builder, resume maker, free cv templates, pdf resume, download cv, professional resume, online cv creator, modern cv">
  
  <!-- ‚úÖ OPEN GRAPH TAGS (Social Media Sharing) -->
  <meta property="og:title" content="Free CV Builder - Create Professional Resumes Online">
  <meta property="og:description" content="Build and download professional CVs for free. Multiple templates, PDF export, and instant download.">
  <meta property="og:image" content="https://moderncvbuilderweb.netlify.app/logo.png">
  <meta property="og:url" content="https://moderncvbuilderweb.netlify.app/">
  <meta property="og:type" content="website">
  
  <!-- ‚úÖ CANONICAL URL -->
  <link rel="canonical" href="https://moderncvbuilderweb.netlify.app/">
  
  <!-- ‚úÖ FAVICON -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">

  <!-- ‚úÖ KEEP YOUR EXISTING STYLES & SCRIPTS -->
  <link rel="stylesheet" href="index.css">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Framer Motion -->
  <script src="https://unpkg.com/framer-motion@11/dist/framer-motion.umd.js"></script>

  <!-- PDF Generation Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Supabase JS (UMD) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
</head>
<body>
  <div id="root"></div>
   <script type="text/babel">
  (function () {
    const { useState, useEffect, useRef, forwardRef } = React;
    const Motion = window['framer-motion'] || {};
    const motion = Motion.motion || (() => null);

    // ==================== TRANSLATIONS ====================
    const translations = {
      en: {
        // Header
        appTitle: 'MODERN CV BUILDER',
        // Landing
        landingTitle: 'BUILD YOUR MODERN CV',
        landingMotto: 'CREATE,PREVIEW,AND DOWNLOAD CV ALL FOR FREE',
        startBuilding: 'START',
        back: 'Back',
        // Personal Info
        personalInfo: 'Personal Information',
        uploadPhoto: 'Upload Photo',
        upload: 'Upload',
        fullName: 'Full Name',
        fullNamePlaceholder: 'Jean Paul Mugabo',
        email: 'Email',
        emailPlaceholder: 'jpmugabo@example.com',
        phone: 'Phone',
        phonePlaceholder: '+250 788 123 456',
        location: 'Location',
        locationPlaceholder: 'Kigali, Rwanda',
        // Professional Summary
        professionalSummary: 'Professional Summary',
        professionalSummaryPlaceholder: 'A dedicated professional...',
        // Education
        education: 'Education',
        institutionName: 'Institution Name',
        institutionPlaceholder: 'University of Rwanda',
        degree: 'Degree',
        degreePlaceholder: "Bachelor's in CS",
        graduationYear: 'Graduation Year',
        graduationYearPlaceholder: '2024',
        addEducation: 'Add Education',
        // Work Experience
        workExperience: 'Work Experience',
        jobTitle: 'Job Title',
        jobTitlePlaceholder: 'Job Title',
        employer: 'Employer',
        employerPlaceholder: 'Employer',
        startDate: 'Start Date',
        startDatePlaceholder: 'Start Date',
        endDate: 'End Date',
        endDatePlaceholder: 'End Date',
        description: 'Description',
        descriptionPlaceholder: 'Description',
        addWork: 'Add Work',
        present: 'Present',
        // Skills
        skills: 'Skills',
        software: 'Software',
        softwarePlaceholder: 'Microsoft Office, Adobe Suite',
        dataTools: 'Data & Analytics',
        dataToolsPlaceholder: 'Excel, Tableau',
        programming: 'Programming',
        programmingPlaceholder: 'Python, JavaScript',
        // Languages
        languages: 'Languages',
        kinyarwanda: 'Kinyarwanda',
        english: 'English',
        french: 'French',
        native: 'Native',
        fluent: 'Fluent',
        intermediate: 'Intermediate',
        basic: 'Basic',
        // Volunteerism
        volunteerism: 'Volunteerism',
        activityRole: 'Activity/Role',
        activityRolePlaceholder: 'Activity/Role',
        organization: 'Organization',
        organizationPlaceholder: 'Organization',
        addVolunteer: 'Add Volunteer',
        // References
        references: 'References',
        referenceName: 'Reference Name',
        referenceNamePlaceholder: 'Reference Name',
        referenceTitle: 'Title',
        referenceTitlePlaceholder: 'Title',
        referenceEmail: 'Email',
        referenceEmailPlaceholder: 'reference@example.com',
        referencePhone: 'Phone',
        referencePhonePlaceholder: '+250 788 000 000',
        addReference: 'Add Reference',
        // Buttons
        downloadPdf: 'Download PDF',
        exportCsv: 'Export CSV',
        livePreview: 'Live Preview',
        // CV Preview
        professionalObjective: 'Professional Objective',
        // Toast messages
        photoUploadError: 'Error uploading photo (submission will continue without photo).',
        savingError: 'Error saving submission (check server).',
        supabaseUnavailable: 'Supabase unavailable ‚Äî submission skipped.',
        submissionSaved: 'Submission saved.',
        cvDownloaded: 'CV downloaded successfully!',
        dataExported: 'Data exported as CSV',
        unexpectedError: 'Unexpected error. Check console.',
      },
      fr: {
        // Header
        appTitle: 'CR√âATEUR DE CV MODERNE',
        // Landing
        landingTitle: 'Cr√©ateur de CV Moderne',
        landingMotto: 'Cr√©ez votre CV, pr√©visualisez-le et t√©l√©chargez-le gratuitement.',
        startBuilding: 'Commencer √† Cr√©er Votre CV',
        back: 'Retour',
        // Personal Info
        personalInfo: 'Informations Personnelles',
        uploadPhoto: 'T√©l√©charger une Photo',
        upload: 'T√©l√©charger',
        fullName: 'Nom Complet',
        fullNamePlaceholder: 'Jean Paul Mugabo',
        email: 'Email',
        emailPlaceholder: 'jpmugabo@exemple.com',
        phone: 'T√©l√©phone',
        phonePlaceholder: '+250 788 123 456',
        location: 'Localisation',
        locationPlaceholder: 'Kigali, Rwanda',
        // Professional Summary
        professionalSummary: 'R√©sum√© Professionnel',
        professionalSummaryPlaceholder: 'Un professionnel d√©vou√©...',
        // Education
        education: '√âducation',
        institutionName: "Nom de l'Institution",
        institutionPlaceholder: 'Universit√© du Rwanda',
        degree: 'Dipl√¥me',
        degreePlaceholder: 'Licence en Informatique',
        graduationYear: "Ann√©e d'Obtention",
        graduationYearPlaceholder: '2024',
        addEducation: 'Ajouter une √âducation',
        // Work Experience
        workExperience: 'Exp√©rience Professionnelle',
        jobTitle: "Titre du Poste",
        jobTitlePlaceholder: 'Titre du Poste',
        employer: 'Employeur',
        employerPlaceholder: 'Employeur',
        startDate: 'Date de D√©but',
        startDatePlaceholder: 'Date de D√©but',
        endDate: 'Date de Fin',
        endDatePlaceholder: 'Date de Fin',
        description: 'Description',
        descriptionPlaceholder: 'Description',
        addWork: 'Ajouter une Exp√©rience',
        present: 'Pr√©sent',
        // Skills
        skills: 'Comp√©tences',
        software: 'Logiciels',
        softwarePlaceholder: 'Microsoft Office, Adobe Suite',
        dataTools: 'Donn√©es et Analyses',
        dataToolsPlaceholder: 'Excel, Tableau',
        programming: 'Programmation',
        programmingPlaceholder: 'Python, JavaScript',
        // Languages
        languages: 'Langues',
        kinyarwanda: 'Kinyarwanda',
        english: 'Anglais',
        french: 'Fran√ßais',
        native: 'Langue Maternelle',
        fluent: 'Courant',
        intermediate: 'Interm√©diaire',
        basic: 'Basique',
        // Volunteerism
        volunteerism: 'B√©n√©volat',
        activityRole: 'Activit√©/R√¥le',
        activityRolePlaceholder: 'Activit√©/R√¥le',
        organization: 'Organisation',
        organizationPlaceholder: 'Organisation',
        addVolunteer: 'Ajouter un B√©n√©volat',
        // References
        references: 'R√©f√©rences',
        referenceName: 'Nom de la R√©f√©rence',
        referenceNamePlaceholder: 'Nom de la R√©f√©rence',
        referenceTitle: 'Titre',
        referenceTitlePlaceholder: 'Titre',
        referenceEmail: 'Email',
        referenceEmailPlaceholder: 'reference@exemple.com',
        referencePhone: 'T√©l√©phone',
        referencePhonePlaceholder: '+250 788 000 000',
        addReference: 'Ajouter une R√©f√©rence',
        // Buttons
        downloadPdf: 'T√©l√©charger PDF',
        exportCsv: 'Exporter CSV',
        livePreview: 'Aper√ßu en Direct',
        // CV Preview
        professionalObjective: 'Objectif Professionnel',
        // Toast messages
        photoUploadError: 'Erreur de t√©l√©chargement de la photo (la soumission continuera sans photo).',
        savingError: 'Erreur lors de la sauvegarde (v√©rifiez le serveur).',
        supabaseUnavailable: 'Supabase indisponible ‚Äî soumission ignor√©e.',
        submissionSaved: 'Soumission enregistr√©e.',
        cvDownloaded: 'CV t√©l√©charg√© avec succ√®s!',
        dataExported: 'Donn√©es export√©es en CSV',
        unexpectedError: 'Erreur inattendue. Consultez la console.',
      },
      rw: {
        // Header
        appTitle: 'URUBUGA RWO GUKORA CV IGEZWEHO',
        // Landing
        landingTitle: "KORA CV IGEZWEHO",
        landingMotto: 'HANGA, UREBE MBERE, KANDI UBIKE CV YAWE BYOSE KU BUNTU.',
        startBuilding: 'TANGIRA',
        back: 'Gusubira Inyuma',
        // Personal Info
        personalInfo: 'Amakuru Yihariye',
        uploadPhoto: 'Ohereza Ifoto',
        upload: 'Ohereza',
        fullName: 'Amazina Yombi',
        fullNamePlaceholder: 'Jean Paul Mugabo',
        email: 'Imeri',
        emailPlaceholder: 'jpmugabo@urugero.com',
        phone: 'Telefoni',
        phonePlaceholder: '+250 788 123 456',
        location: 'Aho Ubarizwa',
        locationPlaceholder: 'Kigali, Rwanda',
        // Professional Summary
        professionalSummary: 'Incamake y\'Umwuga',
        professionalSummaryPlaceholder: 'Umukozi wiyemeje...',
        // Education
        education: 'Amashuri',
        institutionName: 'Izina ry\'Ishuri',
        institutionPlaceholder: 'Kaminuza y\'u Rwanda',
        degree: 'Impamyabumenyi',
        degreePlaceholder: 'Icyiciro cya Kabiri muri Mudasobwa',
        graduationYear: 'Umwaka wo Kurangiza',
        graduationYearPlaceholder: '2024',
        addEducation: 'Ongeraho Amashuri',
        // Work Experience
        workExperience: 'Uburambe bw\'Akazi',
        jobTitle: 'Umwanya w\'Akazi',
        jobTitlePlaceholder: 'Umwanya w\'Akazi',
        employer: 'Umukoresha',
        employerPlaceholder: 'Umukoresha',
        startDate: 'Itariki yo Gutangira',
        startDatePlaceholder: 'Itariki yo Gutangira',
        endDate: 'Itariki yo Kurangiza',
        endDatePlaceholder: 'Itariki yo Kurangiza',
        description: 'Ibisobanuro',
        descriptionPlaceholder: 'Ibisobanuro',
        addWork: 'Ongeraho Akazi',
        present: 'Ubu',
        // Skills
        skills: 'Ubumenyi',
        software: 'Porogaramu',
        softwarePlaceholder: 'Microsoft Office, Adobe Suite',
        dataTools: 'Amakuru n\'Isesengura',
        dataToolsPlaceholder: 'Excel, Tableau',
        programming: 'Guhindura Porogaramu',
        programmingPlaceholder: 'Python, JavaScript',
        // Languages
        languages: 'Indimi',
        kinyarwanda: 'Ikinyarwanda',
        english: 'Icyongereza',
        french: 'Igifaransa',
        native: 'Ururimi Kavukire',
        fluent: 'Neza Cyane',
        intermediate: 'Hagati',
        basic: 'Shingiro',
        // Volunteerism
        volunteerism: 'Ubushake',
        activityRole: 'Igikorwa/Uruhare',
        activityRolePlaceholder: 'Igikorwa/Uruhare',
        organization: 'Ishyirahamwe',
        organizationPlaceholder: 'Ishyirahamwe',
        addVolunteer: 'Ongeraho Ubushake',
        // References
        references: 'Abantu Baguha Icyiyerekano',
        referenceName: 'Izina ry\'Uwaguha Icyiyerekano',
        referenceNamePlaceholder: 'Izina ry\'Uwaguha Icyiyerekano',
        referenceTitle: 'Umutwe',
        referenceTitlePlaceholder: 'Umutwe',
        referenceEmail: 'Imeri',
        referenceEmailPlaceholder: 'icyiyerekano@urugero.com',
        referencePhone: 'Telefoni',
        referencePhonePlaceholder: '+250 788 000 000',
        addReference: 'Ongeraho Icyiyerekano',
        // Buttons
        downloadPdf: 'Pakura PDF',
        exportCsv: 'Kohereza CSV',
        livePreview: 'Kureba Ako Kanya',
        // CV Preview
        professionalObjective: 'Intego z\'Umwuga',
        // Toast messages
        photoUploadError: 'Ikosa mu kohereza ifoto (kohereza bizakomeza nta foto).',
        savingError: 'Ikosa mu kubika (reba seriveri).',
        supabaseUnavailable: 'Supabase ntiboneka ‚Äî kohereza byaretswe.',
        submissionSaved: 'Kohereza byabitswe.',
        cvDownloaded: 'CV yapakuwe neza!',
        dataExported: 'Amakuru yoherejwe muri CSV',
        unexpectedError: 'Ikosa ritunguranye. Reba console.',
      }
    };

    // Translation helper
    const useTranslation = (language) => {
      return (key) => translations[language]?.[key] || translations.en[key] || key;
    };

    // ==================== Supabase config & client ====================
    const SUPABASE_URL = 'https://hjbgrykqfffaptgrrgte.supabase.co';
    const SUPABASE_ANON_KEY = 'sb_publishable_ia54-SrDLWB8upMOtPqCOg_FdWMC_Js';

    // UMD exposes `supabase` global with createClient function
    const supabase = (window.supabase && typeof window.supabase.createClient === 'function')
      ? window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
      : null;

    if (!supabase) console.warn('Supabase client not available. Make sure @supabase/supabase-js UMD is loaded.');

    // Helper: convert dataURL -> File
    const dataUrlToFile = (dataUrl, filename) => {
      const arr = dataUrl.split(',');
      const mimeMatch = arr[0].match(/:(.*?);/);
      const mime = mimeMatch ? mimeMatch[1] : 'image/png';
      const bstr = atob(arr[1]);
      let n = bstr.length;
      const u8arr = new Uint8Array(n);
      while (n--) u8arr[n] = bstr.charCodeAt(n);
      try {
        return new File([u8arr], filename, { type: mime });
      } catch (err) {
        const blob = new Blob([u8arr], { type: mime });
        blob.name = filename;
        return blob;
      }
    };

    // Robust public URL extractor for different supabase-js UMD shapes
    const extractPublicUrl = (res) => {
      if (!res) return null;
      if (res.data && (res.data.publicUrl || res.data.publicURL)) return res.data.publicUrl || res.data.publicURL;
      if (res.publicUrl || res.publicURL) return res.publicUrl || res.publicURL;
      return null;
    };

    // Check whether a storage bucket exists (best-effort).
    // With anon keys, missing bucket typically yields 404; permission errors may still occur.
    async function bucketExists(bucketName) {
      if (!supabase) return false;
      try {
        const { data, error } = await supabase.storage.from(bucketName).list({ limit: 1 });
        if (error) {
          // 404 => bucket missing. Other errors likely permission-related: assume exists but inaccessible.
          if (error.status === 404 || (error?.message && /not found/i.test(error.message))) return false;
          console.warn('Storage list returned error (permission?/inaccessible):', error);
          return true;
        }
        return true;
      } catch (err) {
        console.warn('bucketExists check failed:', err);
        return false;
      }
    }

    // Simple Toast
    function Toast({ message, onClose }) {
      useEffect(() => {
        const t = setTimeout(onClose, 3000);
        return () => clearTimeout(t);
      }, [onClose]);
      return (
        <div className="toast">
          <div className="flex items-center gap-2">
            <span className="text-lg">‚úì</span>
            <span>{message}</span>
          </div>
        </div>
      );
    }

    // Minimal Header
    function Header({ language, setLanguage, theme, setTheme }) {
      const t = useTranslation(language);
      const toggleTheme = () => {
        const newTheme = theme === 'light' ? 'dark' : 'light';
        setTheme(newTheme);
        if (newTheme === 'dark') document.documentElement.classList.add('dark');
        else document.documentElement.classList.remove('dark');
      };
      return (
        <header className="fixed top-0 left-0 right-0 z-50 glass no-print transition-colors duration-300">
          <div className="container mx-auto px-4 py-3 flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-lg bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 flex items-center justify-center shadow-lg">
                <span className="text-white font-bold text-sm">CV</span>
              </div>
              <span className="font-semibold text-white hidden sm:inline">{t('appTitle')}</span>
            </div>

            <div className="flex items-center gap-3">
              <select value={language} onChange={(e) => setLanguage(e.target.value)} className="px-3 py-1.5 rounded-lg text-sm transition-colors duration-300">
                <option value="en">English</option>
                <option value="rw">Kinyarwanda</option>
                <option value="fr">Fran√ßais</option>
              </select>

              <button onClick={toggleTheme} className="theme-toggle" aria-label="Toggle theme">
                <div className="theme-toggle-circle">{theme === 'light' ? '‚òÄÔ∏è' : 'üåô'}</div>
              </button>
            </div>
          </div>
        </header>
      );
    }

    // Footer Component
    function Footer() {
      return (
        <footer className="w-full py-6 mt-12 border-t border-white/20 no-print">
          <div className="container mx-auto px-4 text-center">
            <p className="text-white/80 text-sm">
              Developed by{' '}
              <a 
                href="https://tuyisengenge-jean-chrisostom.github.io/TUYISENGE-Jean-Chrisostom/" 
                target="_blank" 
                rel="noopener noreferrer"
                className="text-white font-semibold hover:text-indigo-300 transition-colors duration-200 underline"
              >
                TUYISENGE Jean Chrisostom
              </a>
            </p>
          </div>
        </footer>
      );
    }

    // Minimal Landing
    function Landing({ onStart, language }) {
      const t = useTranslation(language);
      return (
        <div className="min-h-screen flex items-center justify-center px-4 pt-20">
          <div className="max-w-3xl text-center">
            <div className="inline-flex mb-8">
              <div className="w-24 h-24 rounded-2xl bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 flex items-center justify-center shadow-2xl">
                <span className="text-4xl">üìÑ</span>
              </div>
            </div>
            <h1 className="text-4xl md:text-5xl font-bold mb-4 text-white">{t('landingTitle')}</h1>
            <p className="text-lg md:text-xl mb-8 text-white opacity-90 max-w-2xl mx-auto">{t('landingMotto')}</p>
            <button onClick={onStart} className="px-8 py-4 text-lg font-semibold bg-white text-purple-600 rounded-xl shadow-2xl"> {t('startBuilding')} </button>
          </div>
        </div>
      );
    }

    // CV Preview (used for PDF render)
    const CVPreview = forwardRef(({ data, language }, ref) => {
      const t = useTranslation(language);
      return (
        <div ref={ref} className="bg-white p-8 shadow-lg" style={{ width: '210mm', minHeight: '297mm' }}>
          <div className="flex items-start gap-6 mb-6 pb-6 border-b-2 border-indigo-500">
            {data.personalInfo?.photo ? (
              <img src={data.personalInfo.photo} alt="profile" className="w-24 h-24 rounded-lg object-cover border-2 border-slate-200" />
            ) : null}
            <div className="flex-1">
              <h1 className="text-3xl font-bold text-slate-900 mb-2">{data.personalInfo?.fullName || 'Your Name'}</h1>
              <div className="flex flex-wrap gap-4 text-sm text-slate-600">
                {data.personalInfo?.email && <div className="flex items-center gap-1">‚úâÔ∏è {data.personalInfo.email}</div>}
                {data.personalInfo?.phone && <div className="flex items-center gap-1">üìû {data.personalInfo.phone}</div>}
                {data.personalInfo?.location && <div className="flex items-center gap-1">üìç {data.personalInfo.location}</div>}
              </div>
            </div>
          </div>

          {data.professionalSummary && (
            <div className="mb-6">
              <h2 className="text-xl font-semibold text-indigo-600 mb-3">{t('professionalObjective')}</h2>
              <p className="text-sm text-slate-700 leading-relaxed">{data.professionalSummary}</p>
            </div>
          )}

          {/* Education (first entry) */}
          {data.education?.[0]?.schoolName && (
            <div className="mb-6">
              <h2 className="text-xl font-semibold text-purple-600 mb-3">{t('education')}</h2>
              <div className="mb-3">
                <div className="flex justify-between items-start">
                  <div>
                    <p className="font-semibold text-slate-900">{data.education[0].schoolName}</p>
                    <p className="text-sm text-slate-600">{data.education[0].degree}</p>
                  </div>
                  <span className="text-sm text-slate-500">{data.education[0].graduationYear}</span>
                </div>
              </div>
            </div>
          )}

          {/* Work (first entry) */}
          {data.workExperience?.[0] && (
            <div className="mb-6">
              <h2 className="text-xl font-semibold text-indigo-600 mb-3">{t('workExperience')}</h2>
              <div className="mb-4">
                <div className="flex justify-between items-start mb-1">
                  <p className="font-semibold text-slate-900">{data.workExperience[0].jobTitle}</p>
                  <span className="text-sm text-slate-500">{data.workExperience[0].startDate} - {data.workExperience[0].current ? t('present') : data.workExperience[0].endDate}</span>
                </div>
                <p className="text-sm text-slate-600 mb-2">{data.workExperience[0].employer}</p>
                <p className="text-sm text-slate-700 leading-relaxed">{data.workExperience[0].description}</p>
              </div>
            </div>
          )}

          {/* Skills */}
          {(data.skills?.software || data.skills?.dataTools || data.skills?.programming) && (
            <div className="mb-6">
              <h2 className="text-xl font-semibold text-pink-600 mb-3">{t('skills')}</h2>
              {data.skills?.software && <div className="mb-2"><strong>{t('software')}:</strong> {data.skills.software}</div>}
              {data.skills?.dataTools && <div className="mb-2"><strong>{t('dataTools')}:</strong> {data.skills.dataTools}</div>}
              {data.skills?.programming && <div className="mb-2"><strong>{t('programming')}:</strong> {data.skills.programming}</div>}
            </div>
          )}

          {/* Languages */}
          {data.languages && data.languages.length > 0 && (
            <div className="mb-6">
              <h2 className="text-xl font-semibold text-cyan-600 mb-3">{t('languages')}</h2>
              <div className="flex gap-4 flex-wrap">
                {data.languages.map((l, i) => <span key={i} className="text-sm text-slate-700">{l.language}: {l.proficiency}</span>)}
              </div>
            </div>
          )}

          {/* Volunteer */}
          {data.volunteerism?.[0] && (
            <div className="mb-6">
              <h2 className="text-xl font-semibold text-purple-600 mb-3">{t('volunteerism')}</h2>
              <p className="font-semibold">{data.volunteerism[0].title}</p>
              <p className="text-sm text-slate-600">{data.volunteerism[0].organization}</p>
              <p className="text-sm text-slate-700">{data.volunteerism[0].description}</p>
            </div>
          )}

          {/* References */}
          {data.references?.[0] && (
            <div className="mb-6">
              <h2 className="text-xl font-semibold text-indigo-600 mb-3">{t('references')}</h2>
              <div className="grid grid-cols-2 gap-4">
                {data.references.slice(0,2).map((r, i) => (
                  <div key={i} className="text-sm">
                    <p className="font-semibold text-slate-900">{r.name}</p>
                    <p className="text-slate-600">{r.title}</p>
                    {r.email && <p className="text-slate-600">{r.email}</p>}
                    {r.phone && <p className="text-slate-600">{r.phone}</p>}
                  </div>
                ))}
              </div>
            </div>
          )}

          <div className="mt-8 pt-4 border-t border-slate-200">
            <div className="flex gap-1 h-1">
              <div className="flex-1 bg-indigo-500"></div>
              <div className="flex-1 bg-purple-500"></div>
              <div className="flex-1 bg-pink-500"></div>
              <div className="flex-1 bg-cyan-500"></div>
            </div>
          </div>
        </div>
      );
    });

    // CV Builder - main interactive area
    function CVBuilder({ onBack, language }) {
      const t = useTranslation(language);
      const [cvData, setCVData] = useState({
        personalInfo: { fullName: '', email: '', phone: '', location: '', photo: '', photoFile: null },
        professionalSummary: '',
        education: [{ id: Date.now().toString(), schoolName: '', degree: '', graduationYear: '' }],
        workExperience: [],
        skills: { software: '', dataTools: '', programming: '' },
        languages: [
          { language: t('kinyarwanda'), proficiency: t('native') },
          { language: t('english'), proficiency: t('intermediate') },
          { language: t('french'), proficiency: t('basic') },
        ],
        volunteerism: [],
        references: [{ id: Date.now().toString(), name: '', title: '', email: '', phone: '' }, { id: (Date.now()+1).toString(), name: '', title: '', email: '', phone: '' }],
      });

      const previewRef = useRef(null);
      const [toast, setToast] = useState(null);
      const [isSubmitting, setIsSubmitting] = useState(false);

      const showToast = (msg) => setToast(msg);

      // handle file input - store both dataURL for preview and file for upload
      const handlePhotoChange = (e) => {
        const file = e.target.files?.[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          setCVData((prev) => ({
            ...prev,
            personalInfo: { ...prev.personalInfo, photo: reader.result, photoFile: file }
          }));
        };
        reader.readAsDataURL(file);
      };

      // Upload profile photo (if provided) and return public URL or null
      const uploadPhotoIfNeeded = async () => {
        try {
          const p = cvData.personalInfo;
          // If there's a file object, upload it
          if (p.photoFile && supabase) {
            const ext = (p.photoFile.name || '').split('.').pop();
            const filename = `profile_${(p.fullName || 'user').replace(/\s+/g,'_')}_${Date.now()}.${ext || 'png'}`;
            const path = filename; // root of bucket
            const { data, error } = await supabase.storage.from('profile-photos').upload(path, p.photoFile, { upsert: false, cacheControl: '3600' });
            if (error) {
              // If upload fails, log and return null
              console.error('Supabase upload error:', error);
              return { error };
            }
            const publicRes = await supabase.storage.from('profile-photos').getPublicUrl(path);
            const publicUrl = extractPublicUrl(publicRes);
            return { publicUrl };
          }
          // If photo is already a URL (e.g., previously uploaded), return it
          if (p.photo && typeof p.photo === 'string' && p.photo.startsWith('http')) {
            return { publicUrl: p.photo };
          }
          // Nothing to upload
          return { publicUrl: null };
        } catch (err) {
          console.error('uploadPhotoIfNeeded error', err);
          return { error: err };
        }
      };

      // Map CV data to the exact table columns required and insert
      const saveToSupabase = async (photoUrl) => {
        if (!supabase) {
          console.warn('Supabase client unavailable ‚Äî skipping DB insert.');
          return { skipped: true };
        }

        const firstEducation = cvData.education?.[0] || {};
        const firstWork = cvData.workExperience?.[0] || {};
        const firstVolunteer = cvData.volunteerism?.[0] || {};
        const firstReference = cvData.references?.[0] || {};

        const kiny = (cvData.languages || []).find(l => l.language.toLowerCase().includes('kinya'))?.proficiency || null;
        const eng = (cvData.languages || []).find(l => l.language.toLowerCase().includes('english') || l.language.toLowerCase() === 'english')?.proficiency || null;
        const fr = (cvData.languages || []).find(l => l.language.toLowerCase().includes('french'))?.proficiency || null;

        // Build payload with only the exact keys requested
        const payload = {
          full_name: cvData.personalInfo.fullName || null,
          email_address: cvData.personalInfo.email || null,
          phone_number: cvData.personalInfo.phone || null,
          location: cvData.personalInfo.location || null,
          professional_summary: cvData.professionalSummary || null,

          institution_name: firstEducation.schoolName || null,
          degree_level: firstEducation.degree || null,
          graduation_year: firstEducation.graduationYear || null,

          job_title: firstWork.jobTitle || null,
          employer: firstWork.employer || null,
          start_date: firstWork.startDate || null,
          end_date: firstWork.endDate || null,

          software_proficiency: cvData.skills.software || null,
          data_analytics_tools: cvData.skills.dataTools || null,
          programming_development: cvData.skills.programming || null,

          kinyarwanda_level: kiny || null,
          english_level: eng || null,
          french_level: fr || null,

          activity_role: firstVolunteer.title || null,
          organization: firstVolunteer.organization || null,
          description: firstVolunteer.description || null,

          reference_name: firstReference.name || null,
          reference_title: firstReference.title || null,
          reference_email: firstReference.email || null,
          reference_phone: firstReference.phone || null,

          photo_url: photoUrl || null
        };

        // IMPORTANT: ensure payload keys exactly match your table columns to avoid PGRST204
        try {
          const { data, error } = await supabase.from('cv_submissions').insert([payload]);
          if (error) {
            console.error('Supabase insert error:', error);
            return { error };
          }
          return { data };
        } catch (err) {
          console.error('Unexpected insert exception:', err);
          return { error: err };
        }
      };

      // Generate PDF from hidden preview and trigger download
      const generateAndDownloadPDF = async () => {
        const node = previewRef.current;
        if (!node) {
          throw new Error('Preview not ready');
        }

        // html2canvas -> convert to image -> jsPDF
        const canvas = await html2canvas(node, { scale: 2, useCORS: true, logging: false });
        const imgData = canvas.toDataURL('image/png');

        // jsPDF may be exposed as window.jspdf (umd) or window.jsPDF
        let pdfInstance;
        if (window.jspdf && window.jspdf.jsPDF) {
          const { jsPDF } = window.jspdf;
          pdfInstance = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
        } else if (window.jsPDF) {
          pdfInstance = new window.jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
        } else {
          throw new Error('jsPDF library missing');
        }

        const pdfWidth = pdfInstance.internal.pageSize.getWidth();
        const pdfHeight = pdfInstance.internal.pageSize.getHeight();
        pdfInstance.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
        const filename = `${(cvData.personalInfo.fullName || 'CV').replace(/\s+/g, '_')}_Rwanda.pdf`;
        pdfInstance.save(filename);
      };

      // Main click handler: upload photo, save to DB, generate PDF
      const handleDownloadClick = async () => {
        setIsSubmitting(true);
        try {
            // Upload photo if needed
            let photoUrl = null;
            const uploadResult = await uploadPhotoIfNeeded();
            if (uploadResult?.error) {
                console.error('Photo upload error:', uploadResult.error);
                showToast(t('photoUploadError'));
            } else {
                photoUrl = uploadResult.publicUrl || null;
            }

            // Insert into DB (only the exact keys required)
            const insertResult = await saveToSupabase(photoUrl);
            if (insertResult?.error) {
                console.error('Insert error:', insertResult.error);
                showToast(t('savingError'));
            } else if (insertResult?.skipped) {
                // supabase not available: we still proceed to generate PDF
                showToast(t('supabaseUnavailable'));
            } else {
                showToast(t('submissionSaved'));
            }

            // Generate and download PDF for user
            await generateAndDownloadPDF();
            showToast(t('cvDownloaded'));
        } catch (err) {
            console.error('Error in handleDownloadClick:', err);
            showToast(t('unexpectedError'));
        } finally {
            setIsSubmitting(false);
        }
      };

      // Basic UI: only key pieces to keep example contained.
      return (
        <div className="min-h-screen pt-20 pb-12">
          <div className="container mx-auto px-4">
            <div className="mb-6">
              <button onClick={onBack} className="px-4 py-2 text-white hover:bg-white/20 rounded-lg flex items-center gap-2 transition-colors duration-300">‚Üê {t('back')}</button>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
              <div className="lg:col-span-2 space-y-6">
                {/* Personal Info */}
                <div className="p-6 card border-l-4 border-l-indigo-500 shadow">
                  <h2 className="text-xl font-semibold mb-6">üë§ {t('personalInfo')}</h2>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div className="md:col-span-2 flex items-start gap-6">
                      <div className="flex-shrink-0">
                        <label className="block text-sm font-medium mb-2">{t('uploadPhoto')}</label>
                        {cvData.personalInfo.photo ? (
                          <div className="relative w-32 h-32 rounded-lg overflow-hidden border-2 border-gray-300">
                            <img src={cvData.personalInfo.photo} alt="Profile" className="w-full h-full object-cover" />
                            <label className="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 hover:opacity-100 cursor-pointer transition-opacity">
                              <span className="text-white text-2xl">üì∑</span>
                              <input type="file" accept="image/*" className="hidden" onChange={handlePhotoChange} />
                            </label>
                          </div>
                        ) : (
                          <label className="w-32 h-32 rounded-lg border-2 border-dashed border-gray-300 flex flex-col items-center justify-center cursor-pointer hover:border-indigo-500 transition-colors">
                            <span className="text-3xl mb-2">üì∑</span>
                            <span className="text-xs text-gray-500">{t('upload')}</span>
                            <input type="file" accept="image/*" className="hidden" onChange={handlePhotoChange} />
                          </label>
                        )}
                      </div>

                      <div className="flex-1 w-full">
                        <label className="block text-sm font-medium mb-2">{t('fullName')}</label>
                        <input type="text" value={cvData.personalInfo.fullName} onChange={(e) => setCVData(prev => ({ ...prev, personalInfo: { ...prev.personalInfo, fullName: e.target.value } }))} placeholder={t('fullNamePlaceholder')} className="w-full px-4 py-2 rounded-lg" />
                      </div>
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">{t('email')}</label>
                      <input type="email" value={cvData.personalInfo.email} onChange={(e) => setCVData(prev => ({ ...prev, personalInfo: { ...prev.personalInfo, email: e.target.value } }))} placeholder={t('emailPlaceholder')} className="w-full px-4 py-2 rounded-lg" />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">{t('phone')}</label>
                      <input type="tel" value={cvData.personalInfo.phone} onChange={(e) => setCVData(prev => ({ ...prev, personalInfo: { ...prev.personalInfo, phone: e.target.value } }))} placeholder={t('phonePlaceholder')} className="w-full px-4 py-2 rounded-lg" />
                    </div>

                    <div className="md:col-span-2">
                      <label className="block text-sm font-medium mb-2">{t('location')}</label>
                      <input type="text" value={cvData.personalInfo.location} onChange={(e) => setCVData(prev => ({ ...prev, personalInfo: { ...prev.personalInfo, location: e.target.value } }))} placeholder={t('locationPlaceholder')} className="w-full px-4 py-2 rounded-lg" />
                    </div>
                  </div>
                </div>

                {/* Professional Summary */}
                <div className="p-6 card border-l-4 border-l-purple-500 shadow">
                  <h2 className="text-xl font-semibold mb-6">üíº {t('professionalSummary')}</h2>
                  <textarea value={cvData.professionalSummary} onChange={(e) => setCVData(prev => ({ ...prev, professionalSummary: e.target.value }))} rows={4} placeholder={t('professionalSummaryPlaceholder')} className="w-full px-4 py-2 rounded-lg" />
                </div>

                {/* Education - only minimal UI for example */}
                <div className="p-6 card border-l-4 border-l-pink-500 shadow">
                  <h2 className="text-xl font-semibold mb-6">üéì {t('education')}</h2>
                  {cvData.education.map((edu, i) => (
                    <div key={edu.id} className="mb-4 p-4 rounded-lg bg-gray-50 dark:bg-gray-800/50">
                      <label className="block text-sm font-medium mb-2">{t('institutionName')}</label>
                      <input type="text" value={edu.schoolName} onChange={(e) => {
                        const arr = [...cvData.education]; arr[i] = { ...arr[i], schoolName: e.target.value }; setCVData(prev => ({ ...prev, education: arr }));
                      }} placeholder={t('institutionPlaceholder')} className="w-full px-4 py-2 rounded-lg mb-2" />
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-medium mb-2">{t('degree')}</label>
                          <input type="text" value={edu.degree} onChange={(e) => { const arr=[...cvData.education]; arr[i]={...arr[i], degree:e.target.value}; setCVData(prev=>({...prev, education:arr})); }} placeholder={t('degreePlaceholder')} className="w-full px-4 py-2 rounded-lg" />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-2">{t('graduationYear')}</label>
                          <input type="text" value={edu.graduationYear} onChange={(e) => { const arr=[...cvData.education]; arr[i]={...arr[i], graduationYear:e.target.value}; setCVData(prev=>({...prev, education:arr})); }} placeholder={t('graduationYearPlaceholder')} className="w-full px-4 py-2 rounded-lg" />
                        </div>
                      </div>
                    </div>
                  ))}
                  <button onClick={() => setCVData(prev => ({ ...prev, education: [...prev.education, { id: Date.now().toString(), schoolName:'', degree:'', graduationYear:'' }] }))} className="text-indigo-600 hover:text-indigo-700">‚ûï {t('addEducation')}</button>
                </div>

                {/* Work Experience (first entry is mapped) */}
                <div className="p-6 card border-l-4 border-l-cyan-500 shadow">
                  <h2 className="text-xl font-semibold mb-6">üè¢ {t('workExperience')}</h2>
                  {cvData.workExperience.map((w, idx) => (
                    <div key={w.id || idx} className="mb-4 p-4 rounded-lg bg-gray-50 dark:bg-gray-800/50">
                      <label className="block text-sm font-medium mb-2">{t('jobTitle')}</label>
                      <input type="text" value={w.jobTitle} onChange={(e) => { const arr=[...cvData.workExperience]; arr[idx]={...arr[idx], jobTitle:e.target.value}; setCVData(prev=>({...prev, workExperience:arr})); }} placeholder={t('jobTitlePlaceholder')} className="w-full px-4 py-2 rounded-lg mb-2" />
                      <label className="block text-sm font-medium mb-2">{t('employer')}</label>
                      <input type="text" value={w.employer} onChange={(e) => { const arr=[...cvData.workExperience]; arr[idx]={...arr[idx], employer:e.target.value}; setCVData(prev=>({...prev, workExperience:arr})); }} placeholder={t('employerPlaceholder')} className="w-full px-4 py-2 rounded-lg mb-2" />
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-medium mb-2">{t('startDate')}</label>
                          <input type="text" value={w.startDate} onChange={(e) => { const arr=[...cvData.workExperience]; arr[idx]={...arr[idx], startDate:e.target.value}; setCVData(prev=>({...prev, workExperience:arr})); }} placeholder={t('startDatePlaceholder')} className="w-full px-4 py-2 rounded-lg" />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-2">{t('endDate')}</label>
                          <input type="text" value={w.endDate} onChange={(e) => { const arr=[...cvData.workExperience]; arr[idx]={...arr[idx], endDate:e.target.value}; setCVData(prev=>({...prev, workExperience:arr})); }} placeholder={t('endDatePlaceholder')} className="w-full px-4 py-2 rounded-lg" />
                        </div>
                      </div>
                      <label className="block text-sm font-medium mb-2 mt-2">{t('description')}</label>
                      <textarea value={w.description} onChange={(e) => { const arr=[...cvData.workExperience]; arr[idx]={...arr[idx], description:e.target.value}; setCVData(prev=>({...prev, workExperience:arr})); }} placeholder={t('descriptionPlaceholder')} rows={3} className="w-full px-4 py-2 rounded-lg"></textarea>
                    </div>
                  ))}
                  <button onClick={() => setCVData(prev => ({ ...prev, workExperience: [...prev.workExperience, { id: Date.now().toString(), jobTitle:'', employer:'', startDate:'', endDate:'', current:false, description:'' }] }))} className="text-indigo-600 hover:text-indigo-700">‚ûï {t('addWork')}</button>
                </div>

                {/* Skills */}
                <div className="p-6 card border-l-4 border-l-indigo-500 shadow">
                  <h2 className="text-xl font-semibold mb-6">üîß {t('skills')}</h2>
                  <label className="block text-sm font-medium mb-2">{t('software')}</label>
                  <input type="text" value={cvData.skills.software} onChange={(e) => setCVData(prev => ({ ...prev, skills: { ...prev.skills, software: e.target.value } }))} placeholder={t('softwarePlaceholder')} className="w-full px-4 py-2 rounded-lg mb-2" />
                  <label className="block text-sm font-medium mb-2">{t('dataTools')}</label>
                  <input type="text" value={cvData.skills.dataTools} onChange={(e) => setCVData(prev => ({ ...prev, skills: { ...prev.skills, dataTools: e.target.value } }))} placeholder={t('dataToolsPlaceholder')} className="w-full px-4 py-2 rounded-lg mb-2" />
                  <label className="block text-sm font-medium mb-2">{t('programming')}</label>
                  <input type="text" value={cvData.skills.programming} onChange={(e) => setCVData(prev => ({ ...prev, skills: { ...prev.skills, programming: e.target.value } }))} placeholder={t('programmingPlaceholder')} className="w-full px-4 py-2 rounded-lg" />
                </div>

                {/* Languages */}
                <div className="p-6 card border-l-4 border-l-purple-500 shadow">
                  <h2 className="text-xl font-semibold mb-6">üåç {t('languages')}</h2>
                  {cvData.languages.map((lang, idx) => (
                    <div key={idx} className="grid grid-cols-2 gap-4 mb-4">
                      <input type="text" value={lang.language} onChange={(e) => { const arr=[...cvData.languages]; arr[idx]={...arr[idx], language:e.target.value}; setCVData(prev=>({...prev, languages:arr})); }} className="w-full px-4 py-2 rounded-lg" />
                      <select value={lang.proficiency} onChange={(e) => { const arr=[...cvData.languages]; arr[idx]={...arr[idx], proficiency:e.target.value}; setCVData(prev=>({...prev, languages:arr})); }} className="w-full px-4 py-2 rounded-lg">
                        <option value={t('native')}>{t('native')}</option>
                        <option value={t('fluent')}>{t('fluent')}</option>
                        <option value={t('intermediate')}>{t('intermediate')}</option>
                        <option value={t('basic')}>{t('basic')}</option>
                      </select>
                    </div>
                  ))}
                </div>

                {/* Volunteer */}
                <div className="p-6 card border-l-4 border-l-pink-500 shadow">
                  <h2 className="text-xl font-semibold mb-6">‚ù§Ô∏è {t('volunteerism')}</h2>
                  {cvData.volunteerism.map((v, i) => (
                    <div key={v.id || i} className="mb-4 p-4 rounded-lg bg-gray-50 dark:bg-gray-800/50">
                      <label className="block text-sm font-medium mb-2">{t('activityRole')}</label>
                      <input type="text" value={v.title} onChange={(e) => { const arr=[...cvData.volunteerism]; arr[i]={...arr[i], title:e.target.value}; setCVData(prev=>({...prev, volunteerism:arr})); }} placeholder={t('activityRolePlaceholder')} className="w-full px-4 py-2 rounded-lg mb-2" />
                      <label className="block text-sm font-medium mb-2">{t('organization')}</label>
                      <input type="text" value={v.organization} onChange={(e) => { const arr=[...cvData.volunteerism]; arr[i]={...arr[i], organization:e.target.value}; setCVData(prev=>({...prev, volunteerism:arr})); }} placeholder={t('organizationPlaceholder')} className="w-full px-4 py-2 rounded-lg mb-2" />
                      <label className="block text-sm font-medium mb-2">{t('description')}</label>
                      <textarea value={v.description} onChange={(e) => { const arr=[...cvData.volunteerism]; arr[i]={...arr[i], description:e.target.value}; setCVData(prev=>({...prev, volunteerism:arr})); }} rows={2} className="w-full px-4 py-2 rounded-lg"></textarea>
                    </div>
                  ))}
                  <button onClick={() => setCVData(prev => ({ ...prev, volunteerism: [...prev.volunteerism, { id: Date.now().toString(), title:'', organization:'', description:'' }] }))} className="text-indigo-600 hover:text-indigo-700">‚ûï {t('addVolunteer')}</button>
                </div>

                {/* References */}
                <div className="p-6 card border-l-4 border-l-cyan-500 shadow">
                  <h2 className="text-xl font-semibold mb-6">üë• {t('references')}</h2>
                  {cvData.references.map((r, idx) => (
                    <div key={r.id || idx} className="mb-4 p-4 rounded-lg bg-gray-50 dark:bg-gray-800/50">
                      <label className="block text-sm font-medium mb-2">{t('referenceName')}</label>
                      <input type="text" value={r.name} onChange={(e) => { const arr=[...cvData.references]; arr[idx]={...arr[idx], name:e.target.value}; setCVData(prev=>({...prev, references:arr})); }} placeholder={t('referenceNamePlaceholder')} className="w-full px-4 py-2 rounded-lg mb-2" />
                      <label className="block text-sm font-medium mb-2">{t('referenceTitle')}</label>
                      <input type="text" value={r.title} onChange={(e) => { const arr=[...cvData.references]; arr[idx]={...arr[idx], title:e.target.value}; setCVData(prev=>({...prev, references:arr})); }} placeholder={t('referenceTitlePlaceholder')} className="w-full px-4 py-2 rounded-lg mb-2" />
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-medium mb-2">{t('referenceEmail')}</label>
                          <input type="email" value={r.email} onChange={(e) => { const arr=[...cvData.references]; arr[idx]={...arr[idx], email:e.target.value}; setCVData(prev=>({...prev, references:arr})); }} placeholder={t('referenceEmailPlaceholder')} className="w-full px-4 py-2 rounded-lg" />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-2">{t('referencePhone')}</label>
                          <input type="tel" value={r.phone} onChange={(e) => { const arr=[...cvData.references]; arr[idx]={...arr[idx], phone:e.target.value}; setCVData(prev=>({...prev, references:arr})); }} placeholder={t('referencePhonePlaceholder')} className="w-full px-4 py-2 rounded-lg" />
                        </div>
                      </div>
                    </div>
                  ))}
                  <button onClick={() => setCVData(prev => ({ ...prev, references: [...prev.references, { id: Date.now().toString(), name:'', title:'', email:'', phone:'' }] }))} className="text-indigo-600 hover:text-indigo-700">‚ûï {t('addReference')}</button>
                </div>

                {/* Action Buttons */}
                <div className="flex flex-col sm:flex-row gap-4 sticky bottom-4 card p-4 shadow-lg no-print">
                  <button onClick={handleDownloadClick} disabled={isSubmitting} className="flex-1 px-6 py-3 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 hover:opacity-90 text-white rounded-lg font-semibold shadow-lg">
                    ‚¨áÔ∏è {t('downloadPdf')}
                  </button>
                  <button onClick={() => {
                    // quick CSV export of main fields
                    const csv = [
                      [t('fullName'), cvData.personalInfo.fullName || ''],
                      [t('email'), cvData.personalInfo.email || ''],
                      [t('phone'), cvData.personalInfo.phone || ''],
                      [t('location'), cvData.personalInfo.location || ''],
                      [t('professionalSummary'), cvData.professionalSummary || '']
                    ].map(r => r.map(c => `"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
                    const blob = new Blob([csv], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a'); a.href = url; a.download = `${(cvData.personalInfo.fullName||'CV').replace(/\s+/g,'_')}_data.csv`; a.click(); URL.revokeObjectURL(url);
                    showToast(t('dataExported'));
                  }} className="flex-1 px-6 py-3 border-2 border-white/30 hover:bg-white/10 rounded-lg font-semibold text-white">
                    üìä {t('exportCsv')}
                  </button>
                </div>
              </div>

              {/* Preview Column */}
              <div className="hidden lg:block">
                <div className="sticky top-24">
                  <div className="mb-4 flex items-center gap-2 text-white">üëÅÔ∏è {t('livePreview')}</div>
                  <div className="max-h-[calc(100vh-200px)] overflow-auto border-2 border-white/30 rounded-lg shadow-xl">
                    <div style={{ transform: 'scale(0.38)', transformOrigin: 'top left', width: '263%' }}>
                      <CVPreview data={cvData} language={language} />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          {toast && <Toast message={toast} onClose={() => setToast(null)} />}

          {/* Hidden full-size preview used for PDF generation */}
          <div id="hidden-preview" aria-hidden="true">
            <CVPreview ref={previewRef} data={cvData} language={language} />
          </div>
        </div>
      );
    }

    // App
    function App() {
      const [showBuilder, setShowBuilder] = useState(false);
      const [language, setLanguage] = useState('en');
      const [theme, setTheme] = useState('light');

      useEffect(() => {
        if (theme === 'dark') document.documentElement.classList.add('dark');
        else document.documentElement.classList.remove('dark');
      }, [theme]);

      return (
        <div className="min-h-screen transition-colors duration-300 flex flex-col">
          <div className="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
            <div className="tech-icon"></div>
            <div className="tech-icon"></div>
            <div className="blob"></div>
            <div className="blob"></div>
            <div className="binary"></div>
          </div>

          <Header language={language} setLanguage={setLanguage} theme={theme} setTheme={setTheme} />

          <div className="flex-1">
            {!showBuilder ? <Landing onStart={() => setShowBuilder(true)} language={language} /> : <CVBuilder onBack={() => setShowBuilder(false)} language={language} />}
          </div>

          <Footer />
        </div>
      );
    }

    // Render app
    const rootEl = document.getElementById('root');
    if (rootEl && ReactDOM.createRoot) {
      const root = ReactDOM.createRoot(rootEl);
      root.render(<App />);
    } else {
      console.error('ReactDOM.createRoot not available');
    }
  })();
  </script>
</body>
</html>
